{% extends 'base.html' %}

{% load static %}

{% block content %}
<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<!-- CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/css/bootstrap.min.css">


<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


</head>

<style>
    .row {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    margin-right: -20px;
    margin-left: -20px;
}



  .progress {
    height: 10px;
    border-radius: 5px;
    overflow: hidden;
    background-color: #f5f5f5;
  }

  .progress-bar {
    height: 100%;
  }

  .bg-success {
    background-color: #28a745;
  }

  .bg-danger {
    background-color: #dc3545;
  }

  .highlight-icon {
    display: flex;
    justify-content: left;
    align-items: left;
    font-size: 1.5rem; 
    color: #000000;
  }
  
  .edit-icon:hover {
    color: blue;
  }
  
  .delete-icon:hover {
    color: red;
  }
  .highlighted-text {
    background-color: #FAFAFA;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    overflow-wrap: break-word;
  }
  
  .highlighted-text p {
    margin: 0;
  }
  
  .highlighted-text p:first-child {
    font-weight: bold;
    margin-bottom: 5px;
    color: black; /* Set the color to orange */
  }
  
  .highlighted-text a {
    word-break: break-all;
    color: black; /* Set the color to orange */
  }
  
  .highlighted-text a:hover {
    text-decoration: underline;
  }
    
  .black-text {
    color: black;
  }
  

  #cancelButton {
    float: right;
    background-color: blue;
    color: white;
  }
  
  
  
</style>

<br><br>
<br><br>
<br><br>

<div class="container">

<div class="row">
    <div class="col-md-4 stretch-card grid-margin">
      <div class="card bg-gradient-danger card-img-holder text-white">
            <div class="card-body" style="background-color:#4e4376;border-radius: 5px;">

            
          <h4 class="font-weight-normal mb-3">No. of Reporters <i class="mdi mdi-chart-line mdi-24px float-right"></i>
          </h4>
          <h5 class="mb-5">(count in no.)</h5>
        </div>
      </div>
    </div>
    
    <div class="col-md-4 stretch-card grid-margin">
      <div class="card bg-gradient-info card-img-holder text-white">
        <div class="card-body" style="background-color: #5aab92;border-radius: 5px;">
          <h4 class="font-weight-normal mb-3">Bugs count<i class="mdi mdi-bookmark-outline mdi-24px float-right"></i>
          </h4>
          <h5 class="mb-5">(count in no.)</h5>
        </div>
      </div>
    </div>
    <div class="col-md-4 stretch-card grid-margin">
      <div class="card bg-gradient-success card-img-holder text-white">
        <div class="card-body" style="background-color: #46aef7;border-radius: 5px;">
          <h4 class="font-weight-normal mb-3">Reported bugs <i class="mdi mdi-diamond mdi-24px float-right"></i>
          </h4>
          <h5 class="mb-5">(No. of repoted bugs)</h5>
        </div>
      </div>
    </div>
    
  </div>
  <br><br>
  
  
    <table class="table table-striped my-4">
        <h4 class="card-title">Records</h4>
      <thead>
        <tr>
          <th> Bug no </th>
          <th> Bug Reporter</th>
          <th> Bug type</th>
          <th> Owner Email</th>
          <th> More detail</th>
          <th style="margin-right: 16px;">&nbsp;Edit | Delete</th>


          
        </tr>
      </thead>
      <tbody>
        {% for i in record %}
        <tr>
          <td>{{ i.ReporterID }}</td>
          <td>{{ i.ReporterName }}</td>
          <td>{{ i.BugType }}</td>
          <td>{{ i.OwnerEmail }}</td>
          <td>
            <div class="highlight-icon">
              <a href="#" class="more-detail-button" data-target="#moreDetailModal{{ i.ReporterID }}" style="color:#000000;">

                &nbsp;&nbsp;
                <i class="bi bi-three-dots"></i>
              </a>
            </div>
          </td>
          <td>
            <div class="highlight-icon">
              <a href="#" data-toggle="modal" data-target="#editBugModal{{ i.ReporterID }}" style="color:#000000">
                <i class="fas fa-pencil-alt edit-icon" style="margin-right: 10px;"></i>
              </a>
                &nbsp;|&nbsp;

                <a href="#" onclick="confirmDelete('{{ i.ReporterID }}')" style="color:#000000">
                  <i class="fas fa-trash delete-icon" style="margin-left: 10px;"></i>
                </a>
                
            </div>
          </td>
        </tr>
        <script>
          function confirmDelete(reporterId) {
            if (confirm("Are you sure you want to delete this record?")) {
              deleteRecord(reporterId);
            }
          }
        
          function deleteRecord(reporterId) {
            // Perform the delete operation using AJAX
            fetch(`/delete/${reporterId}/`, {
              method: 'POST',
              headers: {
                'X-CSRFToken': getCookie('csrftoken'), // Ensure to include the CSRF token
                'Content-Type': 'application/json',
              },
            })
              .then((response) => response.json())
              .then((data) => {
                // Handle the response data or perform any necessary actions after deletion
                console.log(data);
                window.location.reload(); // Redirect to the same page
              })
              .catch((error) => {
                // Handle any error that occurred during the request
                console.error(error);
              });
          }
        
          // Helper function to retrieve the CSRF token from cookies
          function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
          }
        </script>
                

        
        

        <!-- More Detail Modal -->
        <div class="modal fade" id="moreDetailModal{{ i.ReporterID }}" tabindex="-1" role="dialog" aria-labelledby="moreDetailLabel{{ i.ReporterID }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="moreDetailLabel{{ i.ReporterID }}">More Detail</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="highlighted-text">
                  <p><strong>Reason:</strong></p>
                  <p class="reason black-text"><b>{{ i.Reason }}</b></p>
                </div>
                <div class="highlighted-text">
                  <p><strong>Site Link:</strong></p>
                  <p class="site-link"><b><a href="{{ i.SiteLink }}" target="_blank">{{ i.SiteLink }}</a></b></p>
                </div>
                
                </div>
              </div>
              
            </div>
          </div>
        </div>
        
                
  {% endfor %}
    </table>




    <br><br><br>




    <!-- <table class="table table-striped my-4">
      <h4 class="card-title">Reporter's <code>Progress</code></h4>
    <thead>
      <tr>
        <th> Reporter name </th>
        <th> Progress </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td> Herman Beck </td>
        <td>
          {% comment %} <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div> {% endcomment %}
        </td>
      </tr>  
      <tr>
        <td> Messsy Adam </td>
        <td>
         {% comment %} <div class="progress">
            <div class="progress-bar bg-danger" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
          </div> {% endcomment %}
        </td>
      </tr>
      {% comment %} <tr>
        <td> John Richards </td>
        <td>
          <!-- <div class="progress">
            <div class="progress-bar bg-warning" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
          </div> -->
        <!-- </td>
        <td> $138.00 </td>
        <td> Apr 12, 2015 </td>
      </tr>
      <tr>
          <td>4213</td>

        <td> Peter Meggik </td>
        <td>
          <!-- <div class="progress">
            <div class="progress-bar bg-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
          </div> -->
        <!-- </td>
        <td> $ 77.99 </td>
        <td> May 15, 2015 </td>
      </tr>
      <tr>
          <td>6213</td>

        <td> Edward </td>
        <td>
          <!-- <div class="progress">
            <div class="progress-bar bg-danger" role="progressbar" style="width: 35%" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></div>
          </div> -->
        <!-- </td>
        <td> $ 160.25 </td>
        <td> May 03, 2015 </td>
      </tr>
      <tr>
          <td>1263</td>

        <td> John Doe </td> -->
        <!-- <td>
          <!-- <div class="progress">
            <div class="progress-bar bg-info" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
          </div> -->
        <!-- </td>
        <td> $ 123.21 </td>
        <td> April 05, 2015 </td>
      </tr> --> 
      <!-- <tr>
          <td>6213</td>

        <td> Henry Tom </td>
        <td> -->
          <!-- <div class="progress">
            <div class="progress-bar bg-warning" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          </div> -->
        <!-- </td>
        <td> $ 150.00 </td>
        <td> June 16, 2015 </td>
      </tr> {% endcomment %}
    </tbody>
  </table> --> 

  </div>
</div>

<script>
  $(document).ready(function() {
    $('.more-detail-button').click(function() {
      var modalId = $(this).data('target');
      $(modalId).modal('show');
    });
  });

  

  </script>
  
{% endblock %}
